<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Alat Impor Data ke Firestore</title>
    <style>
        body { font-family: sans-serif; padding: 2rem; background-color: #f4f4f4; }
        .container { max-width: 600px; margin: auto; background: #fff; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h1 { color: #333; }
        input[type="file"] { margin-bottom: 1rem; }
        button { background: #28a745; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; }
        button:disabled { background: #ccc; }
        #log { margin-top: 1rem; padding: 1rem; background: #333; color: #00ff00; font-family: monospace; height: 300px; overflow-y: auto; border-radius: 5px; }
        #log p { margin: 0; padding: 0 0 5px 0; border-bottom: 1px solid #444; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Alat Impor GeoJSON ke Firestore</h1>
        <p>Pilih file `export.geojson` yang Anda unduh dari Overpass Turbo.</p>
        
        <input type="file" id="geojson-file" accept=".geojson">
        <button id="import-btn">Mulai Impor</button>

        <div id="log"></div>
    </div>

    <script type="module">
        // --- SCRIPT IMPOR ---

        // Ganti dengan firebaseConfig dari PROYEK BARU Anda
       const firebaseConfig = {
  apiKey: "AIzaSyD20pmKLS-camDW4Fupu23qwzPK6R1AplY",
  authDomain: "info-klenteng-df46f.firebaseapp.com",
  projectId: "info-klenteng-df46f",
  storageBucket: "info-klenteng-df46f.firebasestorage.app",
  messagingSenderId: "416766280539",
  appId: "1:416766280539:web:c40c1f7903d87b0558507e",
  measurementId: "G-M21P3MZN96"
};

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import { getFirestore, collection, addDoc, writeBatch, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        const fileInput = document.getElementById('geojson-file');
        const importBtn = document.getElementById('import-btn');
        const logDiv = document.getElementById('log');

        function log(message) {
            logDiv.innerHTML += `<p>> ${message}</p>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        importBtn.addEventListener('click', async () => {
            const file = fileInput.files[0];
            if (!file) {
                log('Error: Silakan pilih file terlebih dahulu.');
                return;
            }

            importBtn.disabled = true;
            importBtn.textContent = 'Memproses...';

            const reader = new FileReader();
            reader.onload = async (event) => {
                try {
                    const geojsonData = JSON.parse(event.target.result);
                    const features = geojsonData.features;
                    log(`Ditemukan ${features.length} lokasi di dalam file.`);
                    
                    // Firestore hanya mengizinkan 500 operasi tulis per batch
                    const batchSize = 400; 
                    for (let i = 0; i < features.length; i += batchSize) {
                        const batch = writeBatch(db);
                        const chunk = features.slice(i, i + batchSize);
                        
                        log(`Memproses batch ${Math.floor(i / batchSize) + 1}...`);
                        
                        chunk.forEach(feature => {
                            const props = feature.properties;
                            const coords = feature.geometry.coordinates;

                            if (props.name) { // Hanya impor jika ada nama
                                const dataToSave = {
                                    nama: props.name,
                                    alamat: props.address || '',
                                    kota: props['addr:city'] || '',
                                    provinsi: props['addr:state'] || '',
                                    lat: coords[1], // Latitude
                                    lon: coords[0], // Longitude
                                    deskripsi: '',
                                    imageUrl: ''
                                };
                                
                                // Buat referensi dokumen baru dan tambahkan ke batch
                                const docRef = collection(db, 'klenteng');
                                batch.set(doc(docRef), dataToSave);
                            }
                        });

                        await batch.commit();
                        log(`Batch ${Math.floor(i / batchSize) + 1} berhasil diimpor.`);
                    }

                    log('SELESAI! Semua data telah berhasil diimpor ke Firestore.');
                } catch (error) {
                    log(`Error: ${error.message}`);
                    console.error(error);
                } finally {
                    importBtn.disabled = false;
                    importBtn.textContent = 'Mulai Impor';
                }
            };
            reader.readAsText(file);
        });
    </script>
</body>
</html>
